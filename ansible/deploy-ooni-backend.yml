---
- hosts: backend-hel.ooni.org
  roles:
    - role: bootstrap
    - role: base-backend
    - role: nftables
    - role: nginx
      tags: nginx
      vars:
        nginx_user: "www-data"
    - role: dehydrated
      tags: dehydrated
      expand: yes
      vars: 
        ssl_domains:
          # with dehydrated the first entry is the cert FQDN
          # and the other ones are alternative names
          - "backend-hel.ooni.org"
    - role: ooni-backend
      vars: 
        ssl_domain: backend-hel.ooni.org
        collector_id: 2
        clickhouse_url: "" # fetch from aws secrets
        bucket_name: ooni-data-eu-fra-test
        collectors: 
          - "backend-hel.ooni.org"
        fastpath_version: 0.86~pr831-395
        analysis_version: 1.12~pr836-413
        deb_bucket_name: ooni-internal-deb
        deb_server_name: deb-cli.ooni.org

# - hosts: backend-fsn.ooni.org
  # roles:
    # - role: bootstrap
    # - role: base-backend
    # - role: nftables
    # - role: nginx
      # tags: nginx
      # vars:
        # nginx_user: "www-data"
    # - role: dehydrated
      # tags: dehydrated
      # expand: yes
      # vars: 
        # ssl_domains:
          # # with dehydrated the first entry is the cert FQDN
          # # and the other ones are alternative names
          # - "backend-hel.ooni.org"
    # - role: ooni-backend
      # vars: 
        # ssl_domain: backend-fsn.ooni.org
        # collector_id: 1
        # clickhouse_url: "" # fetch from aws secrets
        # bucket_name: ooni-data-eu-fra
        # collectors: 
          # - "backend-fsn.ooni.org"
        # fastpath_version: 0.86~pr831-395
        # analysis_version: 1.12~pr836-413
        # deb_bucket_name: ooni.deb
        # deb_server_name: deb.ooni.org
